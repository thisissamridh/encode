{"id":"b3xt","dependencies":[{"name":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/tsconfig.json","includedInParent":true,"mtime":1663687003068},{"name":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/package.json","includedInParent":true,"mtime":1663951495938},{"name":"tslib","loc":{"line":4,"column":24},"parent":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm/barretenberg_wasm.ts","resolved":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/node_modules/tslib/tslib.es6.js"},{"name":"fs","loc":{"line":5,"column":21},"parent":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm/barretenberg_wasm.ts","resolved":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/node_modules/parcel-bundler/src/builtins/_empty.js"},{"name":"detect-node","loc":{"line":6,"column":59},"parent":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm/barretenberg_wasm.ts","resolved":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/node_modules/detect-node/browser.js"},{"name":"util","loc":{"line":72,"column":73},"parent":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm/barretenberg_wasm.ts","resolved":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/node_modules/util/util.js"},{"name":"events","loc":{"line":8,"column":25},"parent":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm/barretenberg_wasm.ts","resolved":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/node_modules/events/events.js"},{"name":"../log","loc":{"line":9,"column":22},"parent":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm/barretenberg_wasm.ts","resolved":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/log/index.ts"},{"name":"../crypto","loc":{"line":10,"column":25},"parent":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm/barretenberg_wasm.ts","resolved":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/crypto/index.ts"},{"name":"../fifo","loc":{"line":11,"column":23},"parent":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm/barretenberg_wasm.ts","resolved":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/fifo/index.ts"},{"name":"buffer","parent":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm/barretenberg_wasm.ts","resolved":"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/node_modules/node-libs-browser/node_modules/buffer/index.js"}],"generated":{"js":"var __dirname = \"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm\";\nvar Buffer = require(\"buffer\").Buffer;\nvar e=\"/mnt/user-data/kev/tmp/aztec-connect/barretenberg.js/src/wasm\",t=require(\"buffer\").Buffer;Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.BarretenbergWasm=exports.fetchCode=void 0;const r=require(\"tslib\"),i=require(\"fs\"),n=(0,r.__importDefault)(require(\"detect-node\")),s=require(\"util\"),o=require(\"events\"),a=require(\"../log\"),c=require(\"../crypto\"),m=require(\"../fifo\");async function u(){if(n.default)return await(0,s.promisify)(i.readFile)(e+\"/barretenberg.wasm\");{const e=await fetch(\"/barretenberg.wasm\");return t.from(await e.arrayBuffer())}}o.EventEmitter.defaultMaxListeners=30,exports.fetchCode=u;class l extends o.EventEmitter{constructor(){super(),this.mutexQ=new m.MemoryFifo,this.mutexQ.put(!0)}static async new(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"wasm\",t=arguments.length>1?arguments[1]:void 0;const r=new l;return r.on(\"log\",(0,a.createDebugLogger)(\"bb:\".concat(e))),await r.init(void 0,t),r}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256;this.emit(\"log\",\"intial mem: \".concat(t)),this.memory=new WebAssembly.Memory({initial:t,maximum:65536}),this.heap=new Uint8Array(this.memory.buffer);const r={wasi_snapshot_preview1:{environ_get:()=>{},environ_sizes_get:()=>{},fd_close:()=>{},fd_read:()=>{},fd_write:()=>{},fd_seek:()=>{},fd_fdstat_get:()=>{},fd_fdstat_set_flags:()=>{},path_open:()=>{},path_filestat_get:()=>{},proc_exit:()=>{},random_get:(e,t)=>{e>>>=0;const r=new Uint8Array(this.memory.buffer),i=(0,c.randomBytes)(t);for(let n=e;n<e+t;++n)r[n]=i[n-e]}},module:{},env:{logstr:e=>{e>>>=0;const t=this.getMemory();let r=e;for(;0!==t[r];++r);const i=(n.default?new(require(\"util\").TextDecoder):new TextDecoder).decode(t.slice(e,r)),s=\"\".concat(i,\" (mem:\").concat(t.length,\")\");this.emit(\"log\",s)},memory:this.memory}};if(e)this.instance=await WebAssembly.instantiate(e,r),this.module=e;else{const{instance:e,module:t}=await WebAssembly.instantiate(await u(),r);this.instance=e,this.module=t}}exports(){return this.instance.exports}call(e){if(!this.exports()[e])throw new Error(\"WASM function \".concat(e,\" not found.\"));try{for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return this.exports()[e](...r)>>>0}catch(n){const t=\"WASM function \".concat(e,\" aborted, error: \").concat(n);throw this.emit(\"log\",t),new Error(t)}}getMemory(){return 0===this.heap.length?new Uint8Array(this.memory.buffer):this.heap}memSize(){return this.getMemory().length}sliceMemory(e,t){return this.getMemory().slice(e,t)}transferToHeap(e,t){const r=this.getMemory();for(let i=0;i<e.length;i++)r[i+t]=e[i]}async acquire(){await this.mutexQ.get()}release(){if(0!==this.mutexQ.length())throw new Error(\"Release called but not acquired.\");this.mutexQ.put(!0)}}exports.BarretenbergWasm=l;"},"sourceMaps":null,"error":null,"hash":"3538c55eda4339d9264353c2c8205a79","cacheData":{"env":{}}}